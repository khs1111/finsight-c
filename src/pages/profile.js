import React, { useState, useMemo, useCallback, useEffect } from 'react';
import TierDummy from '../assets/tier/gold.png';
import TierMaster from '../assets/tier/master.png';
import TierDiamond from '../assets/tier/diamond.png';
import TierGold from '../assets/tier/gold.png';
import TierSilver from '../assets/tier/silver.png';
import TierBronze from '../assets/tier/bronze.png';
import TierEmerald from '../assets/tier/emerald.png';
import AntImg from '../assets/profile/ant.png';
import BackImg from '../assets/profile/back.png';
import { fetchProfile, fetchProfileActivity, fetchDashboard, fetchBadgeById } from '../api/profile';
import './Profile.css';

const actionItems = [
  { key: 'settings', label: '프로필 설정', svg: (
    <svg width="16" height="20" viewBox="0 0 16 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
      <path d="M12.6401 20H3.36009C2.34927 19.9633 1.40766 19.477 0.792441 18.6742C0.17722 17.8713 -0.0473393 16.8356 0.180094 15.85L0.420094 14.71C0.69613 13.1668 2.02272 12.0327 3.59009 12H12.4101C13.9775 12.0327 15.3041 13.1668 15.5801 14.71L15.8201 15.85C16.0475 16.8356 15.823 17.8713 15.2077 18.6742C14.5925 19.477 13.6509 19.9633 12.6401 20Z" fill="#448FFF" />
      <path d="M8.50009 10H7.50009C5.29096 10 3.50009 8.20915 3.50009 6.00001V3.36001C3.49743 2.46807 3.85057 1.61189 4.48127 0.981192C5.11197 0.350491 5.96815 -0.00265152 6.86009 1.49917e-05H9.14009C10.032 -0.00265152 10.8882 0.350491 11.5189 0.981192C12.1496 1.61189 12.5028 2.46807 12.5001 3.36001V6.00001C12.5001 7.06088 12.0787 8.0783 11.3285 8.82844C10.5784 9.57859 9.56096 10 8.50009 10Z" fill="#448FFF" />
    </svg>
  ) },
  { key: 'tier', label: '티어 보기', svg: (
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
      <path d="M11.2568 1.12207C11.7168 0.856632 12.2832 0.856632 12.7432 1.12207L21.0488 5.91699C21.5089 6.18261 21.792 6.67384 21.792 7.20508V16.7949C21.792 17.3262 21.5089 17.8174 21.0488 18.083L12.7432 22.8779C12.2832 23.1434 11.7168 23.1434 11.2568 22.8779L2.95117 18.083C2.49111 17.8174 2.20801 17.3262 2.20801 16.7949V7.20508C2.20801 6.67384 2.49111 6.18261 2.95117 5.91699L11.2568 1.12207Z" fill="#448FFF" stroke="white" strokeWidth="1.2" />
      <g filter="url(#filter0_d_1093_7067)">
        <path fillRule="evenodd" clipRule="evenodd" d="M10.8015 8.27509C10.9455 7.80928 11.3789 7.49385 11.8665 7.50009C12.3567 7.49517 12.7911 7.81532 12.9315 8.28509L13.2615 9.28509C13.4096 9.7479 13.8405 10.0614 14.3265 10.0601H15.3665C15.8638 10.0412 16.314 10.3529 16.4714 10.8251C16.6288 11.2973 16.4557 11.8167 16.0465 12.1001L15.1915 12.7251C14.7974 13.0082 14.6316 13.5136 14.7815 13.9751L15.1115 14.9751C15.2248 15.3213 15.1636 15.7009 14.9471 15.9939C14.7306 16.2869 14.3857 16.4569 14.0215 16.4501C13.7853 16.4483 13.5558 16.3712 13.3665 16.2301L12.5465 15.6051C12.1532 15.3183 11.6197 15.3183 11.2265 15.6051L10.3665 16.2301C10.1748 16.3843 9.93738 16.4705 9.69145 16.4751C9.32459 16.4781 8.97929 16.3021 8.76624 16.0034C8.55318 15.7048 8.49915 15.321 8.62145 14.9751L8.95145 13.9751C9.11044 13.515 8.95257 13.0049 8.56145 12.7151L7.70645 12.0901C7.31014 11.8058 7.14341 11.2976 7.29422 10.8338C7.44503 10.3699 7.8787 10.057 8.36645 10.0601H9.40645C9.89512 10.0601 10.3268 9.74186 10.4715 9.27509L10.8015 8.27509ZM12.1315 8.53509C12.1007 8.41536 11.9899 8.33383 11.8665 8.34009C11.7369 8.33565 11.6238 8.42737 11.6015 8.55509L11.2715 9.55509C11.0092 10.3632 10.2561 10.9104 9.40645 10.9101H8.34645C8.22863 10.9135 8.12555 10.9903 8.08861 11.1022C8.05168 11.2142 8.08879 11.3372 8.18145 11.4101L9.03645 12.0351C9.72609 12.5339 10.015 13.4208 9.75145 14.2301L9.42145 15.2301C9.38904 15.3122 9.40235 15.4053 9.45645 15.4751C9.51256 15.5559 9.60319 15.6058 9.70145 15.6101C9.76146 15.6083 9.81931 15.5873 9.86645 15.5501L10.7115 14.9251C11.4002 14.4247 12.3327 14.4247 13.0215 14.9251L13.8565 15.5201C13.9036 15.5573 13.9614 15.5783 14.0215 15.5801C14.1153 15.574 14.2014 15.5263 14.2565 15.4501C14.3106 15.3803 14.3239 15.2872 14.2915 15.2051L13.9615 14.2051C13.6979 13.3958 13.9868 12.5089 14.6765 12.0101L15.5315 11.3901C15.6241 11.3172 15.6612 11.1942 15.6243 11.0822C15.5874 10.9703 15.4843 10.8935 15.3665 10.8901H14.3265C13.4768 10.8904 12.7237 10.3432 12.4615 9.53509L12.1315 8.53509Z" fill="white" />
        <path d="M12.1315 8.53509C12.1007 8.41536 11.9899 8.33383 11.8665 8.34009C11.7369 8.33565 11.6238 8.42737 11.6015 8.55509L11.2715 9.55509C11.0092 10.3632 10.2561 10.9104 9.40645 10.9101H8.34645C8.22863 10.9135 8.12555 10.9903 8.08861 11.1022C8.05168 11.2142 8.08879 11.3372 8.18145 11.4101L9.03645 12.0351C9.72609 12.5339 10.015 13.4208 9.75145 14.2301L9.42145 15.2301C9.38904 15.3122 9.40235 15.4053 9.45645 15.4751C9.51256 15.5559 9.60319 15.6058 9.70145 15.6101C9.76146 15.6083 9.81931 15.5873 9.86645 15.5501L10.7115 14.9251C11.4002 14.4247 12.3327 14.4247 13.0215 14.9251L13.8565 15.5201C13.9036 15.5573 13.9614 15.5783 14.0215 15.5801C14.1153 15.574 14.2014 15.5263 14.2565 15.4501C14.3106 15.3803 14.3239 15.2872 14.2915 15.2051L13.9615 14.2051C13.6979 13.3958 13.9868 12.5089 14.6765 12.0101L15.5315 11.3901C15.6241 11.3172 15.6612 11.1942 15.6243 11.0822C15.5874 10.9703 15.4843 10.8935 15.3665 10.8901H14.3265C13.4768 10.8904 12.7237 10.3432 12.4615 9.53509L12.1315 8.53509Z" fill="white" />
      </g>
      <defs>
        <filter id="filter0_d_1093_7067" x="4.23926" y="4.5" width="15" height="15" filterUnits="userSpaceOnUse" colorInterpolationFilters="sRGB">
          <feFlood floodOpacity="0" result="BackgroundImageFix" />
          <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
          <feOffset />
          <feGaussianBlur stdDeviation="0.75" />
          <feComposite in2="hardAlpha" operator="out" />
            <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
          <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_1093_7067" />
          <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_1093_7067" result="shape" />
        </filter>
      </defs>
    </svg>
  ) },
  { key: 'premium', label: '프리미엄 구독', svg: (
    <svg width="22" height="20" viewBox="0 0 22 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
      <path d="M19.3002 1.70029L21.0002 6.30029C21.328 7.20131 21.2053 8.20473 20.6702 9.00029C20.0631 9.88531 19.0727 10.4306 18.0002 10.4703C16.3264 10.5981 14.815 9.47104 14.4602 7.83029C14.4602 7.83029 14.4002 7.83029 14.3902 7.83029C14.0587 9.42145 12.6241 10.5387 11.0002 10.4703C9.38373 10.5287 7.96043 9.41373 7.63019 7.83029C7.63019 7.83029 7.57019 7.83029 7.56019 7.83029C7.36659 8.71023 6.83065 9.47691 6.07075 9.961C5.31085 10.4451 4.3895 10.6067 3.51019 10.4103C2.7286 10.2818 2.01898 9.87735 1.51019 9.27029C0.850463 8.43469 0.683016 7.31203 1.07019 6.32029L2.73019 1.70029C3.12019 0.717001 4.08276 0.0819413 5.14019 0.110286H16.8902C17.9476 0.0819413 18.9102 0.717001 19.3002 1.70029Z" fill="#448FFF"/>
      <path d="M18.1002 12.0003V17.1003C18.0845 17.66 17.847 18.1905 17.44 18.575C17.033 18.9595 16.4899 19.1664 15.9302 19.1503H13.1002V16.0003C13.0463 14.9489 12.1518 14.1393 11.1002 14.1903C10.5805 14.1846 10.0775 14.3737 9.69019 14.7203C9.31758 15.0415 9.10239 15.5084 9.10019 16.0003V19.1503H6.27019C5.70371 19.1664 5.15456 18.954 4.74638 18.5609C4.33821 18.1678 4.10533 17.627 4.10019 17.0603V12.0003H4.18019C5.43353 12.0027 6.64387 11.5435 7.58019 10.7103C9.54262 12.4223 12.4678 12.4223 14.4302 10.7103C15.3701 11.5506 16.5894 12.0105 17.8502 12.0003H18.1002Z" fill="#BFD9FF"/>
    </svg>
  ) },
  { key: 'mission', label: '미션 보기', svg: (
    <svg width="14" height="19" viewBox="0 0 14 19" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
      <path d="M12.16 4.25H11.25C10.3419 4.3012 9.56368 3.60792 9.51 2.7V2.62C9.48427 2.1821 9.28522 1.77247 8.95685 1.48162C8.62848 1.19078 8.19781 1.04266 7.76 1.07H1.5V0.75C1.5 0.335786 1.16421 0 0.75 0C0.335786 0 0 0.335786 0 0.75V17.75C0 18.1642 0.335786 18.5 0.75 18.5C1.16421 18.5 1.5 18.1642 1.5 17.75V9.47H2.67C3.57807 9.41881 4.35632 10.1121 4.41 11.02V11.08C4.46368 11.9879 5.24194 12.6812 6.15 12.63H12.15C13.0581 12.6812 13.8363 11.9879 13.89 11.08V5.78C13.8207 4.88669 13.0551 4.20954 12.16 4.25Z" fill="#448FFF"/>
    </svg>
  ) },
  { key: 'inquiry', label: '문의하기', svg: (
    <svg width="16" height="20" viewBox="0 0 16 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
      <path fillRule="evenodd" clipRule="evenodd" d="M10.07 8.23997H14.86C15.1361 8.23997 15.36 8.46383 15.36 8.73997V15.66C15.36 17.8691 13.5691 19.66 11.36 19.66H4.45996C2.25082 19.66 0.459961 17.8691 0.459961 15.66V4.49997C0.459961 2.29083 2.25082 0.49997 4.45996 0.49997H7.12996C7.4061 0.49997 7.62996 0.723828 7.62996 0.99997V5.77997C7.6273 6.42975 7.88288 7.05398 8.34047 7.51532C8.79806 7.97666 9.42018 8.23732 10.07 8.23997ZM4.05996 8.73997C3.50768 8.73997 3.05996 9.18769 3.05996 9.73997L3.06996 11.13C3.06996 11.6823 3.51768 12.13 4.06996 12.13H5.45996C6.01225 12.13 6.45996 11.6823 6.45996 11.13V9.73997C6.45996 9.18769 6.01225 8.73997 5.45996 8.73997H4.05996ZM3.80996 13.18H8.23996C8.65417 13.18 8.98996 13.5158 8.98996 13.93C8.98996 14.3442 8.65417 14.68 8.23996 14.68H3.80996C3.39575 14.68 3.05996 14.3442 3.05996 13.93C3.05996 13.5158 3.39575 13.18 3.80996 13.18ZM3.80996 17.18H9.70996C10.1242 17.18 10.46 16.8442 10.46 16.43C10.46 16.0158 10.1242 15.68 9.70996 15.68H3.80996C3.39575 15.68 3.05996 16.0158 3.05996 16.43C3.05996 16.8442 3.39575 17.18 3.80996 17.18Z" fill="#448FFF"/>
      <path d="M8.67996 1.07997V5.64997C8.67996 6.47287 9.34706 7.13997 10.17 7.13997H14.79C15.0444 7.17877 15.2918 7.0359 15.3853 6.7961C15.4788 6.55629 15.3935 6.28369 15.18 6.13997L9.62996 0.63997C9.46365 0.47745 9.21421 0.434614 9.00322 0.53234C8.79222 0.630066 8.66356 0.848017 8.67996 1.07997Z" fill="#BAD5FF"/>
    </svg>
  ) },
  { key: 'logout', label: '로그아웃', svg: (
    <svg width="14" height="19" viewBox="0 0 14 19" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
      <path d="M7.6911 0.290793L13.6853 6.12079C14.0926 6.50253 14.1063 7.13255 13.7161 7.53079C13.5231 7.72011 13.2603 7.82659 12.9861 7.82659C12.712 7.82659 12.4492 7.72011 12.2561 7.53079L7.98927 3.41079V14.0408C7.98927 14.5931 7.52894 15.0408 6.96111 15.0408C6.39327 15.0408 5.93295 14.5931 5.93295 14.0408V3.41079L1.69694 7.53079C1.289 7.87057 0.680915 7.84772 0.301145 7.47836C-0.0786254 7.10899 -0.102113 6.51755 0.247231 6.12079L6.2414 0.290793C6.64242 -0.0969309 7.29008 -0.0969309 7.6911 0.290793Z" fill="#448FFF"/>
      <path d="M1.82031 16.0408H12.1019C12.6697 16.0408 13.1301 16.4885 13.1301 17.0408C13.1301 17.5931 12.6697 18.0408 12.1019 18.0408H1.82031C1.25248 18.0408 0.792153 17.5931 0.792153 17.0408C0.792153 16.4885 1.25248 16.0408 1.82031 16.0408Z" fill="#BAD5FF"/>
    </svg>
  ) },
  { key: 'withdraw', label: '계정 탈퇴', svg: (
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
      <path fillRule="evenodd" clipRule="evenodd" d="M10 0C4.47715 0 0 4.47715 0 10C0 15.5228 4.47715 20 10 20C15.5228 20 20 15.5228 20 10C20 7.34784 18.9464 4.8043 17.0711 2.92893C15.1957 1.05357 12.6522 0 10 0ZM1.5 10C1.49028 6.61789 3.4912 3.5534 6.5916 2.202C9.69199 0.850603 13.299 1.47073 15.77 3.78L3.77 15.78C2.30543 14.2124 1.49363 12.1453 1.5 10ZM4.9 16.78C6.36674 17.8945 8.15785 18.4986 10 18.5C13.2228 18.5077 16.1714 16.6878 17.6093 13.8035C19.0472 10.9192 18.7259 7.4691 16.78 4.9L4.9 16.78Z" fill="#448FFF"/>
    </svg>
  ) },
];


const z = (n) => (n < 10 ? `0${n}` : `${n}`);

function buildMonthDays(year, month) {

  const first = new Date(year, month, 1);
  const firstWeekday = first.getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const prevMonthDays = new Date(year, month, 0).getDate();

  const cells = [];

  for (let i = firstWeekday - 1; i >= 0; i--) {
    const dayNum = prevMonthDays - i;
    const dateObj = new Date(year, month - 1, dayNum);
    cells.push({
      key: `${dateObj.getFullYear()}-${z(dateObj.getMonth() + 1)}-${z(dayNum)}`,
      day: dayNum,
      inCurrent: false,
      dateObj,
    });
  }

  for (let d = 1; d <= daysInMonth; d++) {
    const dateObj = new Date(year, month, d);
    cells.push({
      key: `${year}-${z(month + 1)}-${z(d)}`,
      day: d,
      inCurrent: true,
      dateObj,
    });
  }

  // 마지막 셀 개수 42개(6주)로 맞추기
  while (cells.length < 42) {
    const d = cells.length - (firstWeekday - 1 + daysInMonth) + 1;
    const dateObj = new Date(year, month + 1, d);
    cells.push({
      key: `${dateObj.getFullYear()}-${z(dateObj.getMonth() + 1)}-${z(dateObj.getDate())}`,
      day: dateObj.getDate(),
      inCurrent: false,
      dateObj,
    });
  }
  return cells;
}



function Calendar() {
  const todayDate = new Date();
  const [viewYear, setViewYear] = useState(todayDate.getFullYear());
  const [viewMonth, setViewMonth] = useState(todayDate.getMonth());
  const [attendanceSet, setAttendanceSet] = useState(new Set());

  useEffect(() => {
    fetchProfileActivity().then(res => {
      // res.data.attendance: ['2024-06-01', ...]
      setAttendanceSet(new Set(res.data.attendance || []));
    }).catch(() => setAttendanceSet(new Set()));
  }, [viewYear, viewMonth]);

  const cells = useMemo(() => buildMonthDays(viewYear, viewMonth), [viewYear, viewMonth]);
  // Find the last in-current-month cell and compute the end index of that row (to keep placeholders in final row)
  const lastRowEndIdx = useMemo(() => {
    let lastIdx = -1;
    for (let i = cells.length - 1; i >= 0; i--) {
      if (cells[i] && cells[i].inCurrent) { lastIdx = i; break; }
    }
    // If nothing found, keep all cells to avoid layout break
    if (lastIdx < 0) return cells.length - 1;
    const rowEnd = Math.min(cells.length - 1, (Math.ceil((lastIdx + 1) / 7) * 7) - 1);
    return rowEnd;
  }, [cells]);
  const headers = ['일', '월', '화', '수', '목', '금', '토'];
  const todayKey = `${todayDate.getFullYear()}-${z(todayDate.getMonth() + 1)}-${z(todayDate.getDate())}`;
  const changeMonth = useCallback((delta) => {
    setViewYear(prev => {
      const d = new Date(prev, viewMonth + delta, 1);
      return d.getFullYear();
    });
    setViewMonth(prev => {
      const d = new Date(viewYear, prev + delta, 1);
      return d.getMonth();
    });
  }, [viewMonth, viewYear]);

  return (
    <div className="p-calendar-wrapper">
      <div className="p-calendar-head">
        <button className="nav-btn" aria-label="prev" onClick={() => changeMonth(-1)}>
          {/* 오른쪽 화살표 (기존 왼쪽 SVG에 scaleX(-1)) */}
          <svg width="10" height="18" viewBox="0 0 10 18" fill="none" xmlns="http://www.w3.org/2000/svg" style={{transform:'scaleX(-1)'}}>
            <path d="M0.999828 17.7498C1.19889 17.7508 1.38994 17.6715 1.52983 17.5298L9.52983 9.52985C9.82228 9.23703 9.82228 8.76266 9.52983 8.46985L1.52983 0.469847C1.23432 0.194488 0.773819 0.202613 0.488207 0.488225C0.202595 0.773837 0.194469 1.23434 0.469829 1.52985L7.93983 8.99985L0.469829 16.4698C0.177375 16.7627 0.177375 17.237 0.469829 17.5298C0.609713 17.6715 0.800762 17.7508 0.999828 17.7498Z" fill="#999999"/>
          </svg>
        </button>
        <span className="month-label">{viewYear}.{viewMonth + 1}</span>
        {/* 왼쪽 화살표 (기존 왼쪽 SVG 그대로) */}
        <button className="nav-btn" aria-label="next" onClick={() => changeMonth(1)}>
          <svg width="10" height="18" viewBox="0 0 10 18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M0.999828 17.7498C1.19889 17.7508 1.38994 17.6715 1.52983 17.5298L9.52983 9.52985C9.82228 9.23703 9.82228 8.76266 9.52983 8.46985L1.52983 0.469847C1.23432 0.194488 0.773819 0.202613 0.488207 0.488225C0.202595 0.773837 0.194469 1.23434 0.469829 1.52985L7.93983 8.99985L0.469829 16.4698C0.177375 16.7627 0.177375 17.237 0.469829 17.5298C0.609713 17.6715 0.800762 17.7508 0.999828 17.7498Z" fill="#999999"/>
          </svg>
        </button>
      </div>
      <div className="p-calendar-grid" role="table" aria-label="학습 캘린더">
        {headers.map(h => (
          <div key={h} className={`cal-cell header ${h === '일' ? 'sun' : h === '토' ? 'sat' : ''}`}>{h}</div>
        ))}
        <div className="calendar-divider" />
  {cells.map((c, idx) => {
          // Drop trailing full empty rows after the last actual week
          if (idx > lastRowEndIdx) return null;
          const baseClasses = ['cal-cell','day'];
          if(!c.inCurrent) baseClasses.push('outside');
          const dateKey = c.key;
          const isToday = dateKey === todayKey;
          const isCompleted = c.inCurrent && attendanceSet.has(dateKey);
          if (isCompleted) baseClasses.push('active');
          if (isToday) baseClasses.push('today');
          if (!c.inCurrent) {
            baseClasses.push('empty');
            return <div key={dateKey} className={baseClasses.join(' ')} aria-hidden="true" />;
          }
          return (
            <div key={dateKey} className={baseClasses.join(' ')} aria-label={`${dateKey}${isCompleted ? ' 완료' : ''}${isToday ? ' 오늘' : ''}`}>
              <div className="cal-date-container">
                <div className="cal-day-number">
                  {isToday ? <div className="today-circle">{c.day}</div> : c.day}
                </div>
                <div className="cal-indicator">
                  {(isCompleted || isToday) ? (
                    <div className="cal-star">
                      <svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fillRule="evenodd" clipRule="evenodd" d="M13.4992 6.06691C13.8832 4.82475 15.0391 3.9836 16.3392 4.00024C17.6466 3.98711 18.8048 4.84084 19.1792 6.09358L20.0592 8.76024C20.4543 9.99441 21.6033 10.8305 22.8992 10.8269H25.6725C26.9989 10.7766 28.1993 11.6078 28.619 12.867C29.0387 14.1262 28.5771 15.5113 27.4859 16.2669L25.2059 17.9336C24.1549 18.6884 23.7129 20.0363 24.1125 21.2669L24.9925 23.9336C25.2949 24.8567 25.1316 25.8691 24.5543 26.6504C23.9769 27.4316 23.0571 27.885 22.0859 27.8669C21.456 27.8622 20.8442 27.6566 20.3392 27.2802L18.1525 25.6136C17.1038 24.8487 15.6812 24.8487 14.6325 25.6136L12.3392 27.2802C11.8281 27.6914 11.195 27.9213 10.5392 27.9336C9.56089 27.9417 8.64008 27.4723 8.07194 26.6759C7.5038 25.8794 7.35971 24.8559 7.68585 23.9336L8.56585 21.2669C8.98983 20.04 8.56882 18.6798 7.52585 17.9069L5.24585 16.2402C4.18901 15.482 3.74439 14.127 4.14656 12.8901C4.54872 11.6531 5.70518 10.8186 7.00585 10.8269H9.77918C11.0823 10.8269 12.2335 9.9783 12.6192 8.73358L13.4992 6.06691ZM17.0459 6.76024C16.9639 6.44096 16.6684 6.22354 16.3392 6.24024C15.9936 6.22841 15.6922 6.47299 15.6325 6.81358L14.7525 9.48024C14.0531 11.6353 12.0449 13.0944 9.77918 13.0936H6.95252C6.63833 13.1026 6.36345 13.3075 6.26495 13.6059C6.16645 13.9044 6.26542 14.2326 6.51252 14.4269L8.79252 16.0936C10.6316 17.4237 11.4019 19.7888 10.6992 21.9469L9.81918 24.6136C9.73276 24.8326 9.76823 25.0809 9.91252 25.2669C10.0621 25.4823 10.3038 25.6155 10.5659 25.6269C10.7259 25.6221 10.8801 25.566 11.0059 25.4669L13.2592 23.8002C15.0957 22.4659 17.5826 22.4659 19.4192 23.8002L21.6459 25.3869C21.7716 25.486 21.9258 25.5421 22.0858 25.5469C22.336 25.5307 22.5658 25.4035 22.7125 25.2002C22.8568 25.0142 22.8923 24.7659 22.8059 24.5469L21.9258 21.8802C21.2231 19.7221 21.9935 17.3571 23.8325 16.0269L26.1125 14.3736C26.3596 14.1793 26.4586 13.8511 26.3601 13.5526C26.2616 13.2541 25.9867 13.0493 25.6725 13.0402H22.8992C20.6335 13.0411 18.6252 11.582 17.9258 9.42691L17.0459 6.76024Z" fill="#FFBC02"/>
                        <path d="M17.0459 6.76024C16.9639 6.44096 16.6684 6.22354 16.3392 6.24024C15.9936 6.22841 15.6922 6.47299 15.6325 6.81358L14.7525 9.48024C14.0531 11.6353 12.0449 13.0944 9.77918 13.0936H6.95252C6.63833 13.1026 6.36345 13.3075 6.26495 13.6059C6.16645 13.9044 6.26542 14.2326 6.51252 14.4269L8.79252 16.0936C10.6316 17.4237 11.4019 19.7888 10.6992 21.9469L9.81918 24.6136C9.73276 24.8326 9.76823 25.0809 9.91252 25.2669C10.0621 25.4823 10.3038 25.6155 10.5659 25.6269C10.7259 25.6221 10.8801 25.566 11.0059 25.4669L13.2592 23.8002C15.0957 22.4659 17.5826 22.4659 19.4192 23.8002L21.6459 25.3869C21.7716 25.486 21.9258 25.5421 22.0858 25.5469C22.336 25.5307 22.5658 25.4035 22.7125 25.2002C22.8568 25.0142 22.8923 24.7659 22.8059 24.5469L21.9258 21.8802C21.2231 19.7221 21.9935 17.3571 23.8325 16.0269L26.1125 14.3736C26.3596 14.1793 26.4586 13.8511 26.3601 13.5526C26.2616 13.2541 25.9867 13.0493 25.6725 13.0402H22.8992C20.6335 13.0411 18.6252 11.582 17.9258 9.42691L17.0459 6.76024Z" fill="#FFBC02"/>
                      </svg>
                    </div>
                  ) : (
                    <span className="no-attendance-circle" />
                  )}
                </div>
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
}

export default function Profile() {
  const [profile, setProfile] = useState({ nickname: '', tier: '', tierImageUrl: '' });
  const normalizeTier = (t) => {
    const s = String(t || '').trim().toLowerCase();
    if (!s) return '';
    if (/(master|마스터)/.test(s)) return 'MASTER';
    if (/(diamond|다이아|dia)/.test(s)) return 'DIAMOND';
    if (/(emerald|에메랄드)/.test(s)) return 'EMERALD';
    if (/(gold|골드)/.test(s)) return 'GOLD';
    if (/(silver|실버)/.test(s)) return 'SILVER';
    if (/(bronze|브론즈)/.test(s)) return 'BRONZE';
    return s.toUpperCase();
  };
  const tierImageFor = (tier, urlFromApi) => {
    if (urlFromApi && typeof urlFromApi === 'string' && urlFromApi.startsWith('http')) return urlFromApi;
    switch (normalizeTier(tier)) {
      case 'MASTER': return TierMaster;
      case 'DIAMOND': return TierDiamond;
      case 'EMERALD': return TierEmerald;
      case 'GOLD': return TierGold;
      case 'SILVER': return TierSilver;
      case 'BRONZE': return TierBronze;
      default: return TierDummy;
    }
  };
  useEffect(() => {
    (async () => {
      try {
        const res = await fetchProfile();
        const base = {
          nickname: res.data.nickname || '',
          tier: res.data.tier || '',
          tierImageUrl: res.data.tierImageUrl || res.data.tier_image_url || '',
        };
        // 배지 아이콘 보강 1순위: 대시보드에서 badgeId 계열 필드 발견 시 단건 조회
        try {
          const userId = Number(localStorage.getItem('userId')) || undefined;
          if (userId) {
            const token = localStorage.getItem('accessToken') || undefined;
            // 1) 대시보드에서 대표 배지 아이콘/ID 직접 사용 시도(백엔드별 구조 대응)
            try {
              const dashRes = await fetchDashboard(userId, token);
              const dash = dashRes?.data || {};
              const ui = dash.userInfo || dash.profile || dash;
              // 아이콘이 바로 있으면 우선 사용
              const directIcon = ui?.badgeIconUrl || ui?.badge_icon_url || dash?.badgeIconUrl || dash?.badge_icon_url || ui?.badge?.iconUrl || ui?.badge?.icon_url;
              if (!base.tierImageUrl && directIcon && /^https?:\/\//i.test(directIcon)) {
                base.tierImageUrl = directIcon;
              }
              const badgeId = (
                // 대표 배지 우선
                ui?.displayed_badge_id || ui?.displayedBadgeId || dash.displayed_badge_id || dash.displayedBadgeId ||
                // 그 외 후보
                ui?.current_badge_id || ui?.currentBadgeId || ui?.badge_id || ui?.badgeId ||
                ui?.badge?.id || dash.current_badge_id || dash.currentBadgeId
              );
              if (badgeId) {
                const bRes = await fetchBadgeById(badgeId, token);
                const b = bRes?.data || bRes; // axios vs fetch 형태 대응
                const icon = b?.iconUrl || b?.icon_url || b?.badge?.iconUrl || b?.badge?.icon_url;
                if (icon && /^https?:\/\//i.test(icon)) {
                  base.tierImageUrl = base.tierImageUrl || icon;
                }
              }
            } catch (_) { /* ignore and fallback to list */ }

            // 2) 리스트 기반 보강은 제거하여 404 소음과 과도한 호출을 방지합니다.
          }
        } catch (_) {}
        setProfile(base);
      } catch (_) {
        setProfile({ nickname: '', tier: '', tierImageUrl: '' });
      }
    })();
  }, []);
  const displayTier = (profile && profile.tier) ? normalizeTier(profile.tier) : 'Bronze';
  const displayNickname = (profile && profile.nickname) ? profile.nickname : '퍼니의 동료';
  return (
    <>
      <div className="p-topbar" aria-label="상단 제목">
        <span className="p-topbar-title profile-spec">프로필</span>
      </div>

      <div className="profile-content-wrapper">
        {/* Hero: background + character + overlayed tier/nickname */}
        <div className="p-hero" aria-label="프로필 히어로">
          <img className="p-hero-bg" src={BackImg} alt="" aria-hidden="true" />
          <div className="p-avatar-block" aria-hidden="true">
            <img src={AntImg} alt="프로필 캐릭터" width={266} height={266} />
          </div>
          <div className="p-hero-shadow" aria-hidden="true" />
          <div className="p-hero-bottom" aria-hidden="true" />
          <div className="p-hero-title" aria-label="티어와 닉네임">
            <div className="tier-inline">
              <img
                className="tier-image"
                src={tierImageFor(displayTier, profile.tierImageUrl)}
                alt={displayTier}
                width={32}
                height={32}
                onError={(e) => { e.currentTarget.src = TierDummy; }}
              />
              <span className="nickname-inline">{displayNickname}</span>
            </div>
          </div>
        </div>

        <div className="p-stats-card">
          <div className="stat">
            <div className="stat-icon no-bg" aria-hidden="true">
            {/* 뉴스 아이콘 SVG (full 64x64) */}
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M27.2542 3.85294C30.0197 1.60771 33.9803 1.60771 36.7458 3.85293L40.1796 6.64079C41.3147 7.56232 42.6935 8.13345 44.1478 8.28445L48.5472 8.74126C52.0903 9.10915 54.8909 11.9097 55.2587 15.4528L55.7155 19.8522C55.8666 21.3065 56.4377 22.6853 57.3592 23.8204L60.1471 27.2542C62.3923 30.0197 62.3923 33.9803 60.1471 36.7458L57.3592 40.1796C56.4377 41.3147 55.8666 42.6935 55.7155 44.1478L55.2587 48.5472C54.8909 52.0903 52.0903 54.8909 48.5472 55.2587L44.1478 55.7155C42.6935 55.8666 41.3147 56.4377 40.1796 57.3592L36.7458 60.1471C33.9803 62.3923 30.0197 62.3923 27.2542 60.1471L23.8204 57.3592C22.6853 56.4377 21.3065 55.8666 19.8522 55.7155L15.4528 55.2587C11.9097 54.8909 9.10915 52.0903 8.74126 48.5472L8.28445 44.1478C8.13345 42.6935 7.56232 41.3147 6.64079 40.1796L3.85294 36.7458C1.60771 33.9803 1.60771 30.0197 3.85293 27.2542L6.64079 23.8204C7.56232 22.6853 8.13345 21.3065 8.28445 19.8522L8.74126 15.4528C9.10915 11.9097 11.9097 9.10915 15.4528 8.74126L19.8522 8.28445C21.3065 8.13345 22.6853 7.56232 23.8204 6.64079L27.2542 3.85294Z" fill="url(#paint0_linear_1086_6468)"/>
              <path d="M27.8477 8.34863C30.2675 6.38406 33.7325 6.38406 36.1523 8.34863L38.4189 10.1885C39.6959 11.2252 41.2478 11.8682 42.8838 12.0381L45.7881 12.3398C48.8882 12.6618 51.3382 15.1118 51.6602 18.2119L51.9619 21.1162C52.1318 22.7522 52.7748 24.3031 53.8115 25.5801L55.6514 27.8477C57.6159 30.2675 57.6159 33.7325 55.6514 36.1523L53.8115 38.4189C52.7748 39.6959 52.1318 41.2478 51.9619 42.8838L51.6602 45.7881C51.3382 48.8882 48.8882 51.3382 45.7881 51.6602L42.8838 51.9619C41.2478 52.1318 39.6959 52.7748 38.4189 53.8115L36.1523 55.6514C33.7325 57.6159 30.2675 57.6159 27.8477 55.6514L25.5801 53.8115C24.3031 52.7748 22.7522 52.1318 21.1162 51.9619L18.2119 51.6602C15.1118 51.3382 12.6618 48.8882 12.3398 45.7881L12.0381 42.8838C11.8682 41.2478 11.2252 39.6959 10.1885 38.4189L8.34863 36.1523C6.38406 33.7325 6.38406 30.2675 8.34863 27.8477L10.1885 25.5801C11.2251 24.3031 11.8682 22.7522 12.0381 21.1162L12.3398 18.2119C12.6618 15.1118 15.1118 12.6618 18.2119 12.3398L21.1162 12.0381C22.7522 11.8682 24.3031 11.2251 25.5801 10.1885L27.8477 8.34863Z" stroke="white" strokeWidth="1.88235"/>
              <ellipse cx="31.9452" cy="34.9817" rx="11.9691" ry="10.2922" fill="white"/>
              <path d="M29.6729 17.1734C32.362 17.8627 31.2909 22.8771 30.3825 25.4151C30.3542 25.4942 30.2968 25.5575 30.2218 25.5955L29.7144 25.8522C29.4466 25.9878 29.1503 25.7221 29.2459 25.4378C31.0962 19.9351 29.8554 19.5854 29.4591 19.4213C28.2598 18.9246 27.3128 20.6889 26.6611 20.9581C26.0094 21.2273 22.6609 22.3563 22.3389 20.9651C22.017 19.5738 26.2573 16.2978 29.6729 17.1734Z" fill="white"/>
              <path d="M34.9639 17.242C32.2132 17.6164 32.6969 22.7208 33.3055 25.3466C33.3245 25.4285 33.3742 25.498 33.4443 25.5443L33.9187 25.858C34.169 26.0235 34.4939 25.7938 34.4319 25.5003C33.2306 19.821 34.5036 19.6168 34.9162 19.4995C36.165 19.1444 36.9015 21.0063 37.5177 21.3489C38.1339 21.6915 41.3293 23.1992 41.8101 21.8544C42.2909 20.5096 38.4581 16.7663 34.9639 17.242Z" fill="white"/>
              <circle cx="28.6198" cy="34.317" r="0.830722" fill="#FFBB02" stroke="#FFBB02" strokeWidth="0.332008"/>
              <circle cx="28.6198" cy="35.6452" r="0.996726" fill="white"/>
              <circle cx="34.6051" cy="34.317" r="0.830722" fill="#FFBB02" stroke="#FFBB02" strokeWidth="0.332008"/>
              <rect x="29.4517" y="31.0117" width="1.66285" height="0.512266" rx="0.256133" transform="rotate(-180 29.4517 31.0117)" fill="#FFBB02" stroke="#FFBB02" strokeWidth="0.332008"/>
              <rect x="35.437" y="31.0117" width="1.66285" height="0.512266" rx="0.256133" transform="rotate(-180 35.437 31.0117)" fill="#FFBB02" stroke="#FFBB02" strokeWidth="0.332008"/>
              <rect x="-0.17125" y="0.0761425" width="0.980263" height="0.264919" rx="0.13246" transform="matrix(-0.359278 0.933231 -0.93357 -0.358396 26.4081 36.0982)" stroke="#FFBB02" strokeWidth="0.264919"/>
              <rect x="-0.17125" y="0.0761425" width="0.980263" height="0.264919" rx="0.13246" transform="matrix(-0.359278 0.933231 -0.93357 -0.358396 36.3823 35.4332)" stroke="#FFBB02" strokeWidth="0.264919"/>
              <rect x="-0.17125" y="0.0761425" width="0.980263" height="0.264919" rx="0.13246" transform="matrix(-0.359278 0.933231 -0.93357 -0.358396 27.4057 36.0982)" stroke="#FFBB02" strokeWidth="0.264919"/>
              <rect x="-0.17125" y="0.0761425" width="0.980263" height="0.264919" rx="0.13246" transform="matrix(-0.359278 0.933231 -0.93357 -0.358396 37.3798 35.4332)" stroke="#FFBB02" strokeWidth="0.264919"/>
              <path d="M21.5028 22.7554C21.7531 22.7158 21.9113 23.0156 21.7372 23.1999L20.1647 24.8645C20.1126 24.9196 20.0866 24.9944 20.0932 25.0699L20.2772 27.1796C20.2988 27.4268 19.9994 27.566 19.8242 27.3902L18.3279 25.8885C18.2745 25.8349 18.2007 25.8067 18.1251 25.8108L15.8362 25.9373C15.5831 25.9513 15.4562 25.6369 15.6481 25.4713L17.2823 24.0607C17.3494 24.0027 17.3832 23.9152 17.3724 23.8273L17.0894 21.5194C17.0581 21.2638 17.3726 21.1175 17.5479 21.3062L19.1322 23.0113C19.1924 23.076 19.2809 23.1066 19.3683 23.0928L21.5028 22.7554Z" fill="white"/>
              <path d="M49.7381 24.6382C49.9885 24.5986 50.1466 24.8984 49.9726 25.0827L48.4001 26.7473C48.348 26.8024 48.3219 26.8772 48.3285 26.9527L48.5126 29.0624C48.5341 29.3096 48.2347 29.4489 48.0596 29.2731L46.5633 27.7713C46.5098 27.7177 46.4361 27.6895 46.3604 27.6936L44.0715 27.8201C43.8185 27.8341 43.6916 27.5198 43.8835 27.3541L45.5176 25.9435C45.5847 25.8856 45.6185 25.798 45.6077 25.7101L45.3248 23.4022C45.2934 23.1466 45.6079 23.0004 45.7832 23.189L47.3676 24.8941C47.4278 24.9588 47.5163 24.9894 47.6037 24.9756L49.7381 24.6382Z" fill="white"/>
              <path d="M48.7163 37.7919C48.954 37.88 48.9451 38.2188 48.7031 38.2942L47.9204 38.5379C47.8481 38.5605 47.7888 38.6128 47.7575 38.6818L47.4484 39.3633C47.3459 39.5892 47.0166 39.5637 46.9502 39.3246L46.7499 38.6039C46.7296 38.5309 46.6791 38.4701 46.611 38.4366L45.8754 38.0755C45.6478 37.9638 45.6911 37.6277 45.9396 37.5772L46.6634 37.4302C46.7502 37.4126 46.8225 37.353 46.8562 37.2712L47.1644 36.5232C47.2625 36.2852 47.6084 36.312 47.6686 36.5623L47.8579 37.3486C47.8786 37.4346 47.9408 37.5047 48.0239 37.5355L48.7163 37.7919Z" fill="white"/>
              <path d="M29.8925 49.0859C30.1303 49.1739 30.1214 49.5127 29.8793 49.5881L29.0967 49.8319C29.0243 49.8544 28.9651 49.9067 28.9338 49.9757L28.6247 50.6572C28.5222 50.8832 28.1929 50.8576 28.1264 50.6186L27.9262 49.8979C27.9059 49.8249 27.8553 49.764 27.7873 49.7306L27.0517 49.3695C26.8241 49.2578 26.8674 48.9216 27.1159 48.8712L27.8397 48.7242C27.9265 48.7066 27.9988 48.6469 28.0325 48.5651L28.3407 47.8172C28.4388 47.5791 28.7847 47.6059 28.8449 47.8562L29.0341 48.6425C29.0548 48.7285 29.1171 48.7986 29.2002 48.8294L29.8925 49.0859Z" fill="white"/>
              <path d="M44.4314 47.4085C44.5825 47.6121 44.3899 47.891 44.146 47.8219L42.3989 47.3272C42.326 47.3066 42.2478 47.318 42.1839 47.3587L40.7706 48.2587C40.5613 48.392 40.2994 48.1907 40.3744 47.9542L40.8804 46.3573C40.9032 46.2851 40.8942 46.2065 40.8554 46.1413L39.9274 44.581C39.7978 44.3632 40.0177 44.1053 40.2534 44.1987L41.8344 44.8257C41.9167 44.8584 42.0098 44.8479 42.0828 44.7978L43.5956 43.7583C43.8078 43.6125 44.0829 43.8239 43.9966 44.0665L43.3815 45.7955C43.3519 45.8789 43.3657 45.9716 43.4185 46.0428L44.4314 47.4085Z" fill="white"/>
              <path d="M16.7733 37.2017C17.0236 37.1621 17.1818 37.4619 17.0077 37.6461L16.7486 37.9204C16.6965 37.9756 16.6705 38.0504 16.6771 38.1259L16.7063 38.4612C16.7279 38.7084 16.4285 38.8477 16.2533 38.6719L16.015 38.4327C15.9616 38.3791 15.8878 38.3508 15.8122 38.355L15.4344 38.3759C15.1813 38.3899 15.0544 38.0755 15.2463 37.9099L15.4819 37.7065C15.549 37.6486 15.5828 37.5611 15.572 37.4731L15.529 37.1226C15.4977 36.8671 15.8122 36.7208 15.9875 36.9094L16.2287 37.1689C16.2888 37.2337 16.3773 37.2643 16.4647 37.2504L16.7733 37.2017Z" fill="white"/>
              <circle cx="34.6051" cy="35.6452" r="0.996726" fill="white"/>
              <path d="M32.6101 35.6455H30.9468C30.7634 35.6455 30.6134 35.7942 30.617 35.9775C30.633 36.7876 30.7606 37.8036 31.7784 37.8036C32.7822 37.8036 32.9201 36.7331 32.9391 35.9772C32.9437 35.7939 32.7934 35.6455 32.6101 35.6455Z" fill="#FFBA02"/>
              <defs>
                <linearGradient id="paint0_linear_1086_6468" x1="7.75758" y1="11.6364" x2="54.303" y2="58.1818" gradientUnits="userSpaceOnUse">
                  <stop stopColor="#FFBC02"/>
                  <stop offset="0.370192" stopColor="#FFAA00"/>
                  <stop offset="0.677885" stopColor="#FFBC02"/>
                  <stop offset="1" stopColor="#FFAA00"/>
                </linearGradient>
              </defs>
            </svg>
          </div>
          <div className="stat-label">뉴스</div>
        </div>
        <div className="stat">
          <div className="stat-icon no-bg" aria-hidden="true">
            {/* 뉴스레터 아이콘 SVG */}
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M27.2542 3.85294C30.0197 1.60771 33.9803 1.60771 36.7458 3.85293L40.1796 6.64079C41.3147 7.56232 42.6935 8.13345 44.1478 8.28445L48.5472 8.74126C52.0903 9.10915 54.8909 11.9097 55.2587 15.4528L55.7155 19.8522C55.8666 21.3065 56.4377 22.6853 57.3592 23.8204L60.1471 27.2542C62.3923 30.0197 62.3923 33.9803 60.1471 36.7458L57.3592 40.1796C56.4377 41.3147 55.8666 42.6935 55.7155 44.1478L55.2587 48.5472C54.8909 52.0903 52.0903 54.8909 48.5472 55.2587L44.1478 55.7155C42.6935 55.8666 41.3147 56.4377 40.1796 57.3592L36.7458 60.1471C33.9803 62.3923 30.0197 62.3923 27.2542 60.1471L23.8204 57.3592C22.6853 56.4377 21.3065 55.8666 19.8522 55.7155L15.4528 55.2587C11.9097 54.8909 9.10915 52.0903 8.74126 48.5472L8.28445 44.1478C8.13345 42.6935 7.56232 41.3147 6.64079 40.1796L3.85294 36.7458C1.60771 33.9803 1.60771 30.0197 3.85293 27.2542L6.64079 23.8204C7.56232 22.6853 8.13345 21.3065 8.28445 19.8522L8.74126 15.4528C9.10915 11.9097 11.9097 9.10915 15.4528 8.74126L19.8522 8.28445C21.3065 8.13345 22.6853 7.56232 23.8204 6.64079L27.2542 3.85294Z" fill="url(#paint0_linear_1093_6726)" />
              <path d="M27.8477 8.34863C30.2675 6.38406 33.7325 6.38406 36.1523 8.34863L38.4189 10.1885C39.6959 11.2252 41.2478 11.8682 42.8838 12.0381L45.7881 12.3398C48.8882 12.6618 51.3382 15.1118 51.6602 18.2119L51.9619 21.1162C52.1318 22.7522 52.7748 24.3031 53.8115 25.5801L55.6514 27.8477C57.6159 30.2675 57.6159 33.7325 55.6514 36.1523L53.8115 38.4189C52.7748 39.6959 52.1318 41.2478 51.9619 42.8838L51.6602 45.7881C51.3382 48.8882 48.8882 51.3382 45.7881 51.6602L42.8838 51.9619C41.2478 52.1318 39.6959 52.7748 38.4189 53.8115L36.1523 55.6514C33.7325 57.6159 30.2675 57.6159 27.8477 55.6514L25.5801 53.8115C24.3031 52.7748 22.7522 52.1318 21.1162 51.9619L18.2119 51.6602C15.1118 51.3382 12.6618 48.8882 12.3398 45.7881L12.0381 42.8838C11.8682 41.2478 11.2252 39.6959 10.1885 38.4189L8.34863 36.1523C6.38406 33.7325 6.38406 30.2675 8.34863 27.8477L10.1885 25.5801C11.2251 24.3031 11.8682 22.7522 12.0381 21.1162L12.3398 18.2119C12.6618 15.1118 15.1118 12.6618 18.2119 12.3398L21.1162 12.0381C22.7522 11.8682 24.3031 11.2251 25.5801 10.1885L27.8477 8.34863Z" stroke="white" strokeWidth="1.88235" />
              <path d="M25.513 26.1768V39H22.9818V29.0947L19.9408 30.0615V28.0664L25.2406 26.1768H25.513ZM35.6113 26.2031L30.918 40.0986H29.0371L33.7305 26.2031H35.6113ZM39.6715 31.5029H41.025C41.4586 31.5029 41.8161 31.4297 42.0973 31.2832C42.3786 31.1309 42.5866 30.9199 42.7213 30.6504C42.862 30.375 42.9323 30.0557 42.9323 29.6924C42.9323 29.3643 42.8678 29.0742 42.7389 28.8223C42.6159 28.5645 42.4254 28.3652 42.1676 28.2246C41.9098 28.0781 41.5846 28.0049 41.192 28.0049C40.8815 28.0049 40.5944 28.0664 40.3307 28.1895C40.067 28.3125 39.8561 28.4854 39.6979 28.708C39.5397 28.9307 39.4606 29.2002 39.4606 29.5166H36.9205C36.9205 28.8135 37.108 28.2012 37.483 27.6797C37.8639 27.1582 38.3737 26.751 39.0123 26.458C39.651 26.165 40.3541 26.0186 41.1217 26.0186C41.9889 26.0186 42.7477 26.1592 43.3981 26.4404C44.0485 26.7158 44.5553 27.123 44.9186 27.6621C45.2819 28.2012 45.4635 28.8691 45.4635 29.666C45.4635 30.0703 45.3698 30.4629 45.1823 30.8438C44.9948 31.2188 44.7252 31.5586 44.3737 31.8633C44.028 32.1621 43.6061 32.4023 43.108 32.584C42.61 32.7598 42.0504 32.8477 41.4293 32.8477H39.6715V31.5029ZM39.6715 33.4277V32.1182H41.4293C42.1266 32.1182 42.7389 32.1973 43.2663 32.3555C43.7936 32.5137 44.236 32.7422 44.5934 33.041C44.9508 33.334 45.2204 33.6826 45.402 34.0869C45.5836 34.4854 45.6745 34.9277 45.6745 35.4141C45.6745 36.0117 45.5602 36.5449 45.3317 37.0137C45.1032 37.4766 44.7809 37.8691 44.3649 38.1914C43.9547 38.5137 43.4743 38.7598 42.9235 38.9297C42.3727 39.0938 41.7721 39.1758 41.1217 39.1758C40.5827 39.1758 40.0524 39.1025 39.5309 38.9561C39.0153 38.8037 38.5465 38.5781 38.1246 38.2793C37.7086 37.9746 37.3746 37.5938 37.1227 37.1367C36.8766 36.6738 36.7536 36.126 36.7536 35.4932H39.2936C39.2936 35.8213 39.3756 36.1143 39.5397 36.3721C39.7038 36.6299 39.9293 36.832 40.2164 36.9785C40.5094 37.125 40.8346 37.1982 41.192 37.1982C41.5963 37.1982 41.942 37.125 42.2291 36.9785C42.5221 36.8262 42.7448 36.6152 42.8971 36.3457C43.0553 36.0703 43.1344 35.751 43.1344 35.3877C43.1344 34.9189 43.0495 34.5439 42.8795 34.2627C42.7096 33.9756 42.4664 33.7646 42.15 33.6299C41.8336 33.4951 41.4586 33.4277 41.025 33.4277H39.6715Z" fill="white" />
              <defs>
                <linearGradient id="paint0_linear_1093_6726" x1="7.75758" y1="11.6364" x2="54.303" y2="58.1818" gradientUnits="userSpaceOnUse">
                  <stop stopColor="#ADADAD" />
                  <stop offset="0.370192" stopColor="#ADACAC" />
                  <stop offset="0.677885" stopColor="#CCCCCC" />
                  <stop offset="1" stopColor="#B0B0B0" />
                </linearGradient>
              </defs>
            </svg>
          </div>
          <div className="stat-label">뉴스레터</div>
        </div>
        <div className="stat">
          <div className="stat-icon no-bg" aria-hidden="true">
            {/* 탐험지 아이콘 SVG */}
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M27.2542 3.85294C30.0197 1.60771 33.9803 1.60771 36.7458 3.85293L40.1796 6.64079C41.3147 7.56232 42.6935 8.13345 44.1478 8.28445L48.5472 8.74126C52.0903 9.10915 54.8909 11.9097 55.2587 15.4528L55.7155 19.8522C55.8666 21.3065 56.4377 22.6853 57.3592 23.8204L60.1471 27.2542C62.3923 30.0197 62.3923 33.9803 60.1471 36.7458L57.3592 40.1796C56.4377 41.3147 55.8666 42.6935 55.7155 44.1478L55.2587 48.5472C54.8909 52.0903 52.0903 54.8909 48.5472 55.2587L44.1478 55.7155C42.6935 55.8666 41.3147 56.4377 40.1796 57.3592L36.7458 60.1471C33.9803 62.3923 30.0197 62.3923 27.2542 60.1471L23.8204 57.3592C22.6853 56.4377 21.3065 55.8666 19.8522 55.7155L15.4528 55.2587C11.9097 54.8909 9.10915 52.0903 8.74126 48.5472L8.28445 44.1478C8.13345 42.6935 7.56232 41.3147 6.64079 40.1796L3.85294 36.7458C1.60771 33.9803 1.60771 30.0197 3.85293 27.2542L6.64079 23.8204C7.56232 22.6853 8.13345 21.3065 8.28445 19.8522L8.74126 15.4528C9.10915 11.9097 11.9097 9.10915 15.4528 8.74126L19.8522 8.28445C21.3065 8.13345 22.6853 7.56232 23.8204 6.64079L27.2542 3.85294Z" fill="url(#paint0_linear_1093_6784)" />
              <path d="M27.8477 8.34863C30.2675 6.38406 33.7325 6.38406 36.1523 8.34863L38.4189 10.1885C39.6959 11.2252 41.2478 11.8682 42.8838 12.0381L45.7881 12.3398C48.8882 12.6618 51.3382 15.1118 51.6602 18.2119L51.9619 21.1162C52.1318 22.7522 52.7748 24.3031 53.8115 25.5801L55.6514 27.8477C57.6159 30.2675 57.6159 33.7325 55.6514 36.1523L53.8115 38.4189C52.7748 39.6959 52.1318 41.2478 51.9619 42.8838L51.6602 45.7881C51.3382 48.8882 48.8882 51.3382 45.7881 51.6602L42.8838 51.9619C41.2478 52.1318 39.6959 52.7748 38.4189 53.8115L36.1523 55.6514C33.7325 57.6159 30.2675 57.6159 27.8477 55.6514L25.5801 53.8115C24.3031 52.7748 22.7522 52.1318 21.1162 51.9619L18.2119 51.6602C15.1118 51.3382 12.6618 48.8882 12.3398 45.7881L12.0381 42.8838C11.8682 41.2478 11.2252 39.6959 10.1885 38.4189L8.34863 36.1523C6.38406 33.7325 6.38406 30.2675 8.34863 27.8477L10.1885 25.5801C11.2251 24.3031 11.8682 22.7522 12.0381 21.1162L12.3398 18.2119C12.6618 15.1118 15.1118 12.6618 18.2119 12.3398L21.1162 12.0381C22.7522 11.8682 24.3031 11.2251 25.5801 10.1885L27.8477 8.34863Z" stroke="white" strokeWidth="1.88235" />
              <path d="M27.9564 31.4766V33.6914C27.9564 34.6523 27.8539 35.4814 27.6488 36.1787C27.4437 36.8701 27.1478 37.4385 26.7611 37.8838C26.3802 38.3232 25.9261 38.6484 25.3988 38.8594C24.8714 39.0703 24.2855 39.1758 23.641 39.1758C23.1254 39.1758 22.6449 39.1113 22.1996 38.9824C21.7543 38.8477 21.3529 38.6396 20.9955 38.3584C20.6439 38.0771 20.3392 37.7227 20.0814 37.2949C19.8295 36.8613 19.6361 36.3457 19.5013 35.748C19.3666 35.1504 19.2992 34.4648 19.2992 33.6914V31.4766C19.2992 30.5156 19.4017 29.6924 19.6068 29.0068C19.8177 28.3154 20.1136 27.75 20.4945 27.3105C20.8812 26.8711 21.3382 26.5488 21.8656 26.3438C22.3929 26.1328 22.9789 26.0273 23.6234 26.0273C24.139 26.0273 24.6166 26.0947 25.056 26.2295C25.5013 26.3584 25.9027 26.5605 26.2601 26.8359C26.6175 27.1113 26.9222 27.4658 27.1742 27.8994C27.4261 28.3271 27.6195 28.8398 27.7543 29.4375C27.889 30.0293 27.9564 30.709 27.9564 31.4766ZM25.4164 34.0254V31.1338C25.4164 30.6709 25.39 30.2666 25.3373 29.9209C25.2904 29.5752 25.2171 29.2822 25.1175 29.042C25.0179 28.7959 24.8949 28.5967 24.7484 28.4443C24.6019 28.292 24.4349 28.1807 24.2474 28.1104C24.0599 28.04 23.8519 28.0049 23.6234 28.0049C23.3363 28.0049 23.0814 28.0605 22.8588 28.1719C22.642 28.2832 22.4574 28.4619 22.305 28.708C22.1527 28.9482 22.0355 29.2705 21.9535 29.6748C21.8773 30.0732 21.8392 30.5596 21.8392 31.1338V34.0254C21.8392 34.4883 21.8627 34.8955 21.9095 35.2471C21.9623 35.5986 22.0384 35.9004 22.138 36.1523C22.2435 36.3984 22.3666 36.6006 22.5072 36.7588C22.6537 36.9111 22.8207 37.0225 23.0082 37.0928C23.2015 37.1631 23.4125 37.1982 23.641 37.1982C23.9222 37.1982 24.1713 37.1426 24.388 37.0312C24.6107 36.9141 24.7982 36.7324 24.9505 36.4863C25.1088 36.2344 25.2259 35.9062 25.3021 35.502C25.3783 35.0977 25.4164 34.6055 25.4164 34.0254ZM35.6113 26.2031L30.918 40.0986H29.0371L33.7305 26.2031H35.6113ZM43.2487 26.1768V39H40.7174V29.0947L37.6764 30.0615V28.0664L42.9762 26.1768H43.2487Z" fill="white" />
              <defs>
                <linearGradient id="paint0_linear_1093_6784" x1="7.75758" y1="11.6364" x2="54.303" y2="58.1818" gradientUnits="userSpaceOnUse">
                  <stop stopColor="#ADADAD" />
                  <stop offset="0.370192" stopColor="#ADACAC" />
                  <stop offset="0.677885" stopColor="#CCCCCC" />
                  <stop offset="1" stopColor="#B0B0B0" />
                </linearGradient>
              </defs>
            </svg>
          </div>
          <div className="stat-label">탐험지</div>
        </div>
      </div>

      <div className="p-actions">
        {actionItems.map(a => (
          <button key={a.key} className="action-row" type="button">
            <span className="icon-placeholder" aria-hidden="true">
              {a.svg ? a.svg : a.icon}
            </span>
            <span className="label">{a.label}</span>
          </button>
        ))}
      </div>

      <Calendar />
    </div>
    </>
  );
}